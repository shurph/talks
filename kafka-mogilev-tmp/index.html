<!DOCTYPE html>
<html lang="en">

<head>
    <title>Построение микросервисных систем с использованием Kafka</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="../vendor/shower/styles/bitnet-16x10.css">
    <link rel="stylesheet" href="../vendor/shower/vendors/highlight/styles/github.css">
    <style>
    
    .cards > div {
        width: 33.33%;
        float: left;
        line-height: 1.6;
    }
    
    .tags-baloons {
        margin-top: 20px;
        text-align: center;
        font-size: 40px;
    }
    .tags-baloons .label {
        border-radius: 15px 20px;
        margin-bottom: 15px;
    }
    </style>
</head>

<body class="shower list">
    <header class="caption">
        <h1>Построение микросервисных систем с использованием Kafka</h1>
        <p>
            <a href="https://twitter.com/shurph">Николай Сасковец</a>
        </p>
    </header>



    <section class="slide black clear"
     style="
        background: url(pictures/kafka-man-filtered.jpg) center center;
        background-size: cover;">
        <h2 class="shout" style="font-size: 42px; white-space: nowrap;">
            Построение микросервисных систем с использованием Kafka
        </h2>
        <span class="slide-footer" style="font-size: 20px; padding: 20px 40px;">
            Николай Сасковец
            <br><br>
        </span>
    
    </section>



    <section class="slide clear black">
        <img src="pictures/microservices-microservices-everywhere.jpeg" alt="" class="cover">          
    </section>
    

    <section class="slide ">
        <img src="pictures/mono-to-micro-1-clean.jpg" alt="" class="cover">
        <!-- image from: https://dev.to/alex_barashkov/microservices-vs-monolith-architecture-4l1m -->
    </section>

    <section class="slide ">
        <img src="pictures/mono-to-micro-2-structured.jpg" alt="" class="cover">
        <!-- image from: https://dzone.com/articles/a-transition-from-monolith-to-microservices -->
    </section>
    

    <section class="slide ">
        <img src="pictures/mono-to-micro-3-more-real.png" alt="" class="cover w">
        <!-- image from: https://medium.com/salesloft-engineering/monolith-to-microservice-without-downtime-a-production-story-652c9b82f03e -->
    </section>
    

    <section class="slide "> <!-- EDITED 1 -->
        <img src="pictures/mono-to-micro-4-even-more-real.png" alt="" class="cover w">
        <!-- image from: https://medium.com/salesloft-engineering/monolith-to-microservice-without-downtime-a-production-story-652c9b82f03e -->
    </section>
    
    <section class="slide "> <!-- EDITED 2 -->
        <img src="pictures/mono-to-micro-5-more-relations.png" alt="" class="cover w">
        <!-- image from: https://medium.com/salesloft-engineering/monolith-to-microservice-without-downtime-a-production-story-652c9b82f03e -->
    </section>
    
    <section class="slide "> <!-- EDITED 3 -->
        <img src="pictures/mono-to-micro-6-a-lot-of-relations.png" alt="" class="cover w">
        <!-- image from: https://medium.com/salesloft-engineering/monolith-to-microservice-without-downtime-a-production-story-652c9b82f03e -->
    </section>
    
    
    <section class="slide">
        <h2>Microservices: Coupling and Cohesion</del></h2>
        <img src="pictures/reusable-services-and-coupling.png" alt="" class="cover">
        <span class="slide-footer">
            by Jeppe Cramon,

            <a href="https://www.tigerteam.dk/2014/microservices-its-not-only-the-size-that-matters-its-also-how-you-use-them-part-3/">
                 tigerteam.dk</a>
        </span>    
    </section>


    <section class="slide"> <!-- EDITED 4 -->
        <h2 style="color: white; border: none">Distributed Monolith?</h2>
        <img src="pictures/distributed-monolith.png" alt="" class="cover h">
        <!-- image from: https://medium.com/salesloft-engineering/monolith-to-microservice-without-downtime-a-production-story-652c9b82f03e -->
    </section>
    <section class="slide">
        <h2>Microservices: Synchronous Communication</h2>
        <center>
            ( REST / gRPC / HTTP )
        </center>
        <img src="pictures/microservices-sync-comm-few.svg" alt="" class="cover w" style="margin-top: 70px">  
    </section>
    
    
    
    <section class="slide">
        <h2>Microservices: Synchronous Communication</h2>
        <center>
            ( REST / gRPC / HTTP )
        </center>
        <img src="pictures/microservices-sync-comm-many.svg" alt="" class="cover w" style="margin-top: 70px">  
    </section>




    
    <section class="slide">
        <h2>Так ли это медленно?</h2>
<pre class="plain"><code>0.3 ns      1 s          1 CPU cycle 
...
120 ns      6 min        Main memory access
50-150 μs   2-6 days     Solid-state disk I/O    
1-10 ms     1-12 months  Rotational disk I/O 
<span style="color:red">10-50 ms    1-5 years    Network request</span>
40 ms       4 years      Internet: SF to NYC</code>
</pre>
        <span class="slide-footer">
            by Jeff Atwood,

            <a href="https://blog.codinghorror.com/the-infinite-space-between-words/">
                 The Infinite Space Between Words
</a>
        </span>    
    </section>

    <section class="slide">
        <h2>Microservices: Async Communication (Celery)</h2>
        <img src="pictures/microservices-async-comm-celery-rabbit.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>


    <section class="slide">
        <h2>Microservices: Async Communication (Kafka)</h2>
        <img src="pictures/microservices-async-comm-kafka.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>


  
    <section class="slide">
        <h2 class="shout">
            What is
            <span style="display: inline-block;  height: 20px;">
                <img src="pictures/logos/kafka-logo-black.png" height="90px" style="
                    position: relative;
                    float: left;
                    margin-top: -45px;
                    opacity: 0.75;">
            </span>
            Kafka?
        </h2> 
    </section>


    <section class="slide">
        <img src="pictures/kafka-grefnevaya.jpg" alt="" class="cover w">  
    </section>
    
    <section class="slide">
        <h2>
            What is
            <span style="display: inline-block;  height: 20px;">
                <img src="pictures/logos/kafka-logo-black.png" height="90px" style="
                    position: relative;
                    float: left;
                    margin-top: -45px;
                    opacity: 0.75;">
            </span>
            Kafka?
        </h2>
         
         
        <div class="tags-baloons">
            <span class="label">
                Distributed Streaming Platform 
            </span>
            <span class="label">
                Распределённый брокер сообщений
            </span>
            <span class="label">
                Распределённая система передачи сообщений
            </span>
        </div>

        Apache Kafka — это распределенная система обмена сообщениями с высокой пропускной способностью, которую можно использовать для упрощения масштабируемого сбора данных. <sup><a href="https://www.ibm.com/support/knowledgecenter/ru/SSPFMY_1.3.5/com.ibm.scala.doc/config/iwa_cnf_scldc_apche_con_c.html" style="background: none">[↪]</a></sup>
    </section> 

    
    <section class="slide">
        <h2>
            Alternatives for Kafka
        </h2>
        <div class="tags-baloons">
            <span class="label">
                RabbitMQ
            </span>
            <span class="label">
                ActiveMQ
            </span>
            
            <br>
            
            <span class="label">
                NUTS
            </span>
            <span class="label">
                Pulsar
            </span>
            <span class="label">
                NSQ
            </span>
        </div>     
    </section> 
         
         
         
    <section class="slide">
        <h2>
            Kafka for what???
        </h2>
        
        <div class="tags-baloons">
            <span class="label">
        Messaging
            </span>
            <span class="label">
        Metrics
            </span>
            <span class="label">
        Website Activity Tracking
            </span>
            <span class="label">
        Log Aggregation
            </span>
            <span class="label">
        Stream Processing
            </span>
            <span class="label">
        Event Sourcing
            </span>
            <span class="label">
        Commit Log
            </span>
        </div>
        <div class="tags-baloons">
            <span class="label">
        Queue
            </span>
        </div>
    </section>
    
    
    


    <section class="slide">
        <h2>Kafka: Overview</h2>
        <img src="pictures/kafka-architecture-overview-zookeeper.png" alt="" class="cover w" style="margin-top: 20px">  
        <span class="slide-footer">
        Fig. from <a href="https://dzone.com/articles/kafka-architecture">dzone.com</a>
        </span>
    </section>
    
    

    <section class="slide">
        <h2>Kafka: Partitions for Topics</h2>
        <img src="pictures/kafka-partitioning-0.png" alt="" class="cover h" style="margin-top: -30px">  
        <span class="slide-footer">
        Fig. from <a href="https://stackoverflow.com/questions/38024514/understanding-kafka-topics-and-partitions">mrsrinivas
</a>
        </span>
    </section>
    

    <section class="slide">
        <h2>Kafka: Partitions (P&lt;C)</h2>
        <img src="pictures/kafka-partitioning-1-few-consumers.png" alt="" class="cover h" style="margin-top: -30px">  
        <span class="slide-footer">
        Fig. from <a href="https://stackoverflow.com/questions/38024514/understanding-kafka-topics-and-partitions">mrsrinivas
</a>
        </span>
    </section>
    <section class="slide">
        <h2>Kafka: Partitions (P=C)</h2>
        <img src="pictures/kafka-partitioning-2-one-to-one-consumers.png" alt="" class="cover h" style="margin-top: -30px">  
        <span class="slide-footer">
        Fig. from <a href="https://stackoverflow.com/questions/38024514/understanding-kafka-topics-and-partitions">mrsrinivas
</a>
        </span>
    </section>
    <section class="slide">
        <h2>Kafka: Partitions (P&gt;C)</h2>
        <img src="pictures/kafka-partitioning-3-too-many-consumers.png" alt="" class="cover h" style="margin-top: -30px">  
        <span class="slide-footer">
        Fig. from <a href="https://stackoverflow.com/questions/38024514/understanding-kafka-topics-and-partitions">mrsrinivas
</a>
        </span>
    </section>
    <section class="slide">
        <h2>Kafka: Partitions: few consumer groups</h2>
        <img src="pictures/kafka-partitioning-4-few-groups-of-consumers.png" alt="" class="cover h" style="margin-top: -30px">  
        <span class="slide-footer">
        Fig. from <a href="https://stackoverflow.com/questions/38024514/understanding-kafka-topics-and-partitions">mrsrinivas
</a>
        </span>
    </section>
    




    <section class="slide">
        <h2>Kafka: Consumers Offsets</h2>
            <pre class="plain"><code style="line-height: 1!important">


          ┌───[Consumer Group 1]
          │<span style="color:red">
1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18</span>
    │
    └───[Consumer Group 2]
            </code></pre>
    </section>


    <section class="slide">
        <h2>Kafka: Consumers Offsets</h2>
            <pre class="plain"><code style="line-height: 1!important">


                  ┌───[Consumer Group 1]
                  │<span style="color:red">
1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20</span>
      │
      └───[Consumer Group 2]
            </code></pre>
    </section>


    <section class="slide">
        <h2>Kafka: Consumers Offsets</h2>
            <pre class="plain"><code style="line-height: 1!important">


                           ┌───[Consumer Group 1]
                           │<span style="color:red">
1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23</span>
│           │
│           └───[Consumer Group 2]
│
└───[Consumer Group 3]
            </code></pre>
    </section>


    <section class="slide">
        <h2>Kafka: Consumers Offsets</h2>
            <pre class="plain"><code style="line-height: 1!important">
                                    [Consumer Group 4]───┐
                                                         │
                           ┌───[Consumer Group 1]        │ 
                           │                             │<span style="color:red">
1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|18|19|20|21|22|23</span>
│           │
│           └───[Consumer Group 2]
│
└───[Consumer Group 3]
            </code></pre>
    </section>
    


    <section class="slide">
        <h2>Kafka: Reset Consumer Group Offsets tooling</h2>
            <pre class="plain"><code >
  Reset to Datetime 
  Reset from Duration
  Reset to Earliest
  Reset to Latest
  Reset to Current Time
  Reset to Offset
  Shift Offset by 'n' 
  Reset from file

            </code></pre>
    </section>

    <section class="slide">
        <h2>Kafka: Overview, again :-)</h2>
        <img src="pictures/kafka-architecture-overview-zookeeper.png" alt="" class="cover w" style="margin-top: 20px">  
        <span class="slide-footer">
        Fig. from <a href="https://dzone.com/articles/kafka-architecture">dzone.com</a>
        </span>
    </section>

    <section class="slide">
        <h2>Kafka: Replication</h2>
        <img src="pictures/kafka-architecture-replication.png" alt="" class="cover w" style="margin-top: 30px">  
        <span class="slide-footer">
        Fig. from <a href="
https://dzone.com/articles/kafka-topic-architecture-replication-failover-and">dzone.com</a>
        </span>
    </section>






    <section class="slide">
        <h2>
            Kafka: стратегии распределения по партициям
        </h2>
        <div class="tags-baloons">
            <span class="label">
                1. random
            </span>
            
            <br>
            
            <span class="label">
                2. По хэшу ключа (если он есть)
            </span>
            
            <br>
            
            <span class="label">
                3. «вручную» указать партицию
            </span>
        </div>     
    </section> 





    <section class="slide black">
        <h2>Kafka: Message structure</h2>
        <h3 class="shout">key, value<br>byte[], byte[]</h3>
    </section>
    
    
    
    <section class="slide black">
        <h2>Kafka: Message structure and content</h2>
        <pre class="javascript" style="background: white"><code style="line-height: 1.2">
    key = {"foo":"bar","numer":1}
    value = {"modelName":"DFGJHL8", "modelYear": 2019}
        </code></pre>
    </section>
    
    
    <section class="slide black">
        <h2>Kafka: Message structure and content...</h2>
        <pre class="javascript" style="background: white"><code style="line-height: 1.2">
    key = {"foo":"bar","numer":1}
    value = {"modelName":"DFGJHL8", "modelYear": 2019}
        </code></pre><pre class="javascript" style="background: white"><code style="line-height: 1.2">
    key = {"foo":"bar","numer":2}
    value = {"modelName":"LKJDF3", "modelYear": 2017}
        </code></pre><pre class="javascript" style="background: white"><code style="line-height: 1.2">
    key = {"foo":"bar","numer":3}
    value = {"modelName":"XXXFFF4", "modelYear": 2009}
        </code></pre><pre class="javascript" style="background: white"><code style="line-height: 1.2">
    key = {"foo":"bar","numer":4}
    value = {"modelName":"AAAEEE5", "modelYear": 1999}
        </code></pre>
    </section>
    
    
    
    <section class="slide">
        <h2>Kafka: Schema</h2>
        <h3 class="shout no-bg"><small style="font-size: 0.5em">Use Avro to define a data schema</small></span>
    </section>
    
    <section class="slide">
        <h2>Kafka: Schema: Avro</h2>
        <pre><code>{   "namespace":"com.example.avroSample.model",
    "type":"record",
    "name":"Automobile",
    "fields":[  {  "name":"modelName",
                   "type":"string"},
                {  "name":"modelYear",
                   "type":"int"}
             ]
}
        </code></pre>
    </section>





    <section class="slide">
        <h2>Kafka: Schema overhead</h2>
        <img src="pictures/confluent_schema_registry-1.png" alt="" class="cover" style="margin-top: 20px">  
        <!-- image from https://www.confluent.io/blog/schemas-contracts-compatibility  -->
    </section>





    <section class="slide">
        <h2>Kafka: Schema: Avro: Schema Registry</h2>
        <ul>
            <li><b><a href="https://ondataengineering.net/technologies/confluent-open-source/">Confluent Schema Registry</a></b></li>
            <li><a href="https://ondataengineering.net/technologies/schema-registry/">Hortonworks Schema Registry</a></li>
            <li><a href="https://github.com/salsify/avro-schema-registry">Avro Schema Registry</a></li>
        </ul>
    </section>




    <section class="slide">
        <h2>Kafka: Schema Registry Concept</h2>
        <img src="pictures/schema-registry-scheme.png" alt="" class="cover w" style="margin-top: 20px">  
    </section>





    <section class="slide black">
        <h2 class="shout">Microservices?</h2>
    </section>




    <section class="slide">
        <h2>Microservices: Async Communication (Kafka). Again</h2>
        <img src="pictures/microservices-async-comm-kafka.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>




    <section class="slide">
        <h2>Microservices: Async. What about databases?</h2>
        <img src="pictures/microservices-async-comm-kafka-detailed.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>
    
    
    

    <section class="slide black">
        <h2>PostgreSQL → Kafka</h2>
        <img src="pictures/logos/debezium.svg" alt="">
    </section>

    <section class="slide">
        <h2>Stream data from PostgreSQL to Kafka</h2>
        <img src="pictures/debezium-architecture.png" alt="" class="cover w" style="margin-top: 30px">  
        <span class="slide-footer">
        Fig. from <a href="
https://debezium.io/documentation/reference/0.9/architecture.html">debezium.io</a>
        </span>
    </section>






    <section class="slide">
        <h2>Microservices: Async. What about databases?</h2>
        <img src="pictures/microservices-async-comm-kafka-detailed.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>
    

    <section class="slide">
        <h2>Microservices: Async. Debezium</h2>
        <img src="pictures/microservices-async-comm-kafka-debezium.svg" alt="" class="cover w" style="margin-top: 20px">  
    </section>


    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Что дальше?
            </span>
        </div>    
    </section>


    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Что дальше?
            </span>
            <div class="tags-baloons" style="font-size: 32px; line-height: 1.8">
                <span class="label">
                    Зависимые запросы
                </span>
                <span class="label">
                    Рапределенные транзакции
                </span>
                <span class="label">
                    SAGA
                </span>
            </div> 
        </div>  
    </section>


    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Что дальше?
            </span>
            <div class="tags-baloons" style="font-size: 32px; line-height: 1.8">
                <span class="label">
                    Зависимые запросы
                </span>
                <span class="label">
                    Рапределенные транзакции
                </span>
                <span class="label">
                    SAGA
                </span>
            </div> 
            <div class="tags-baloons" style="font-size:26px; line-height: 1.8">
                <span class="label">
                    Тонкий «тюнинг»
                </span>
                <span class="label">
                    Multi Datacenter Setup
                </span>
            </div> 
        </div>  
    </section>

    
    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Что дальше?
            </span>
            <div class="tags-baloons" style="font-size: 32px; line-height: 1.8">
                <span class="label">
                    Зависимые запросы
                </span>
                <span class="label">
                    Рапределенные транзакции
                </span>
                <span class="label">
                    SAGA
                </span>
            </div> 
            <div class="tags-baloons" style="font-size:26px; line-height: 1.8">
                <span class="label">
                    Тонкий «тюнинг»
                </span>
                <span class="label">
                    Multi Datacenter Setup
                </span>
            </div> 
            <div class="tags-baloons" style="font-size:22px; line-height: 1.8">
                <span class="label">
                    KSQL
                </span>
                <span class="label">
                    Kafka Streams
                </span>
            </div> 
        </div>  
    </section>


    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Спасибо!
            </span>
        </div>    
    </section>
    
    
    <section class="slide black">
        <div class="tags-baloons shout">
            <span class="label">
                Вопросы?
            </span>
        </div>    
    </section>

    <div class="progress"></div>

    <footer class="badge">
        <a href="https://github.com/shurph/talks">Fork me on GitHub!</a>
    </footer>

    <script src="../vendor/shower/scripts/shower.min.js"></script>

    <script src="../vendor/shower/vendors/highlight/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
</body>

</html>
